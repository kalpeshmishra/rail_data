<% @method = "POST" %>
<% @url = admin_crack_rakes_path %>
<div class="table-responsive" style="overflow-x: scroll; overflow-y: scroll;">
  <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8" >
    <p style="font-size: 20px;color:red;">Crack Rakes :&nbsp;&nbsp;&nbsp;</p>
  </div>
<%= form_tag(@url, method: @method, class: 'form-horizontal', id: 'crack-rakes-form',remote: true) do |form| %>
<table class="table hover table-dark span12" style="margin-bottom: 20px !important; overflow-x: scroll; ">
  <thead>
  <tr>
    <th>SR NO</th>
    <th>Train No.<br>Power No.</th>
    <th>Ordering<br> Time/Date</th>
    <th>On-duty<br> Time/Date</th>
    <th>Departure<br>Time/Date</th>
    <th>Station<br>PreDep-(Detn)</th>
    <th>DHG(Arr)<br>Time/Date</th>
    <th>TOR Dep to<br>DHG Arr</th>
    <th>GIMB(Arr)<br>Time/Date</th>
    <th>OFF Duty</th>
    <th>Detn on to_off<br>TOR Dep to GIMB Arr</th>
    <th>Remarks</th>
    <th>Action</th>
  </tr>
  </thead>
  <tbody>
    
      <%(0..25).each_with_index do |no, index| %>

       <tr class="crack-rake-tr crack-row-data crack_rake_row_<%= index %>", id= "crack_rake_row_id_<%= index %>">
        <td align="center" style="font-size: 25;">
        </td>
        <td>
          <%= text_field_tag "train_name_#{index}", '', placeholder: 'Train No', id: "train_name_#{index}", class: 'form-control input-md', style: "width: 125px; text-transform:uppercase;"%>
        <p></p>
          <%= text_field_tag "power_no_#{index}", '', placeholder: 'Power No', id: "train_name_#{index}", class: 'form-control input-md', style: "width: 125px; text-transform:uppercase;"%>
        </td>
        <td>
          <%= text_field_tag "order_time_#{index}", '', type: 'time',placeholder: 'order time', id: "order_time_#{index}", class: 'form-control input-md', required: true, style: "width: 148px; font-size:14px;"%>
        <p></p>
          <%= text_field_tag "order_date_#{index}", '', type: 'date',placeholder: 'order Date', id: "order_date_#{index}", class: 'form-control input-md order_date',required: true, style: "width: 148px; font-size:14px;"%>
        </td>
        <td>
          <%= text_field_tag "onduty_time_#{index}", '', type: 'time',placeholder: 'onduty Date', id: "onduty_time_#{index}", class: 'form-control input-md', required: true, style: "width: 148px; font-size:14px;"%>
        <p></p>
          <%= text_field_tag "onduty_date_#{index}", '', type: 'date',placeholder: 'onduty Date', id: "onduty_date_#{index}", class: 'form-control input-md onduty_date',required: true, style: "width: 148px; font-size:14px;"%>
        </td>
        <td>
          <%= text_field_tag "departure_time_#{index}", '', type: 'time',placeholder: 'departure Date', id: "departure_time_#{index}", class: 'form-control input-md', required: true, style: "width: 148px; font-size:14px;"%>
        <p></p>
          <%= text_field_tag "departure_date_#{index}", '', type: 'date',placeholder: 'departure Date', id: "departure_date_#{index}", class: 'form-control input-md departure_date',required: true, style: "width: 148px; font-size:14px;"%>
        </td>
        <td>
          <%= select_tag "bpc_type_#{index}", options_for_select([["SMYD","SMYD"],["VY","VY"]]), {prompt: "Type", class: 'form-control input-md',style: "width: 80px; font-size:14px", id: "bpc_type_#{index}", data_live_search: "true"} %>
        <p></p>
          <%= text_field_tag "pre_departure_#{index}",'', placeholder: "PDD", class: 'form-control input-md pre_departure', id: "pre_departure_#{index}",readonly: true, style: "width: 80px;border: 1px solid #888; font-size:15px;background-color:#ffe6e6;" %>
        </td>
       <td>
          <%= text_field_tag "dhgarr_time_#{index}", '', type: 'time',placeholder: 'dhgarr Date', id: "dhgarr_time_#{index}", class: 'form-control input-md', required: true, style: "width: 148px; font-size:14px;"%>
        <p></p>
          <%= text_field_tag "dhgarr_date_#{index}", '', type: 'date',placeholder: 'dhgarr Date', id: "dhgarr_date_#{index}", class: 'form-control input-md dhgarr_date',required: true, style: "width: 148px; font-size:14px;"%>
        </td>
        <td>
          <%= text_field_tag "tor_deptoarr_#{index}",'', placeholder: "TOR", class: 'form-control input-md tor_deptoarr', id: "tor_deptoarr_#{index}",readonly: true, style: "width: 80px;border: 1px solid #888; font-size:15px;background-color:#ffe6e6;" %>
        </td>
        <td>
          <%= text_field_tag "gimbarr_time_#{index}", '', type: 'time',placeholder: 'gimbarr Date', id: "gimbarr_time_#{index}", class: 'form-control input-md', required: true, style: "width: 160px; font-size:16px;"%>
        <p></p>
          <%= text_field_tag "gimbarr_date_#{index}", '', type: 'date',placeholder: 'gimbarr Date', id: "gimbarr_date_#{index}", class: 'form-control input-md gimbarr_date',required: true, style: "width: 160px; font-size:16px;"%>
        </td>
        <td>
          <%= text_field_tag "offduty_time_#{index}", '', type: 'time',placeholder: 'offduty Date', id: "offduty_time_#{index}", class: 'form-control input-md', required: true, style: "width: 160px; font-size:16px;"%>
        <p></p>
          <%= text_field_tag "offduty_date_#{index}", '', type: 'date',placeholder: 'offduty Date', id: "offduty_date_#{index}", class: 'form-control input-md offduty_date',required: true, style: "width: 160px; font-size:16px;"%>
        </td>
        <td>
          <%= text_field_tag "detn_ontooff_#{index}",'', placeholder: "DETN", class: 'form-control input-md detn_ontooff', id: "detn_ontooff_#{index}",readonly: true, style: "width: 80px;border: 1px solid #888; font-size:15px;background-color:#ffe6e6;" %>
        <p></p>
          <%= text_field_tag "tor_deptogimbarr_#{index}",'', placeholder: "TOR", class: 'form-control input-md tor_deptogimbarr', id: "tor_deptogimbarr_#{index}",readonly: true, style: "width: 80px;border: 1px solid #888; font-size:15px;background-color:#ffe6e6;" %>
        </td>
        <td>
          <%= text_area_tag "remarks_#{index}", '', placeholder: 'enter remarks if any', id: "remarks_#{index}", class: 'form-control input-md', style: "width: 155px; height:80px;"%>
          <%= hidden_field_tag  "record_id_#{index}", "", id: "record_id_#{index}" %>
          
        </td>
        <td align="center">
          <a href="#" class="remove-ip label label-danger" id="<%= index %>-other-load_delete" style="padding: 20%"><i class="fa fa-trash-o"></i></a>          
        </td>
      </tr>    
    <%end%>  
  </tbody>
</table>
  <div class= "form-group station_error_msg" id="station_error_msg" style="display: none"></div>
  <%= hidden_field_tag  "date", "", id: "date" %>
  <input type="button" class="btn btn-success btn-flat fa-input" value="&#xf067;&nbsp;&nbsp;Add Row" id="crack_rake_add">
  <div class="modal-footer" style="text-align: center !important;">
    <button class="btn btn-primary btn-flat submit" type="submit"><i class="fa fa-check submit"></i>Save</button>
  </div>   
  <% end %>
</div>

<div class="modal fade colored-header" id="delete-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" style="width: 350px;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>You really want to delete this Row?</h3>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body" align="center">
        
          <input type="button" class="btn btn-danger btn-lg" value="Delete" id="confirm_crack_rake_delete">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <input type="button" class="btn btn-default btn-lg" data-dismiss="modal" value="Cancel"id="cancel">
     
     </div>
    </div>
  </div>
</div>

<script >
$(function(){

  $('table tr').each(function(index) {
    $(this).find('td:nth-child(1)').html(index-1+1);
  });
 
  <% (0..25).each_with_index do |no,index| %>
    <%if index >= (0)%>
      var tr = '<%=".crack_rake_row_#{index}"%>';
      $(tr).hide();
    <%end%> 
  <% end %>
   <%if @crack_rakes.present?%>
      <%@crack_rakes.each_with_index do |data,index|%>
          from_station = "#from_station_"+<%=index%>
          to_station = "#to_station_"+<%=index%>
          loaded_unit = "#loaded_unit_"+<%=index%>
          rake_count = "#rake_count_"+<%=index%>
          major_commodity = "#major_commodity_"+<%=index%>
          wagon_type = "#wagon_type_"+<%=index%>
          gross_tons ="#gross_tons_"+<%=index%>
          net_tons =  "#net_tons_"+<%=index%>
          odr_type = "#odr_type_"+<%=index%>
          odr_date = "#odr_date_"+<%=index%>
          release_time = "#release_time_"+<%=index%>
          release_date = "#release_date_"+<%=index%>
          remarks = "#remarks_"+<%=index%>
          rake_id = "#record_id_"+<%=index%>

          $(from_station).val('<%=Station.where(id: LoadUnload.where(id: data.load_unload_id).pluck(:station_id)[0]).pluck(:code)[0]%>');
          $(to_station).val('<%=Station.where(id: data.station_id).pluck(:code)[0]%>');
          $(loaded_unit).val('<%=data.loaded_unit%>');
          $(rake_count).val('<%=data.rake_count%>');
          $(major_commodity).val('<%=data.major_commodity_id%>');
          $(wagon_type).val('<%=data.wagon_type_id%>');
          $(gross_tons).val('<%=data.gross_tons%>');
          $(net_tons).val('<%=data.net_tons%>');
          $(odr_type).val('<%=data.odr_type%>');
          $(odr_date).val('<%=data.odr_date%>');
          $(release_time).val('<%=data.release_time%>');
          $(release_date).val('<%=data.release_date%>');
          $(remarks).val('<%=data.remark%>');
          $(rake_id).val('<%=data.id%>');
          
      <%end%>
    <%end%>

  $("#crack_rake_add").click(function(){
    $(".crack-row-data:hidden").each(function(i){
      if (i==0) {
        $(this).show();
      }
    });
  });

  $(".submit").click(function () {
    $("#date").val($("#datepicker").val());
    $(".crack-row-data:hidden").each(function(i) {
      $(this).remove('');
    });
  });
  
  $('#crack-rakes-form').submit(function(){
    $("button[type='submit']", this)
      .text("Please Wait...")
      .attr('disabled', 'disabled');
    return true;
  });

  $(".label-danger").on('click',function(){
    delete_index = $(this).attr('id').split("-")[0];
    delete_crack_rake_id = $("#record_id_"+delete_index).val();
    var visible_row_count = 0
    
    $('.other-load-tr:visible').each(function() {
      visible_row_count = visible_row_count + 1
    });
    
    $("#delete-modal").modal('show');
   

  });

  $("#confirm_crack_rake_delete").click(function () {
    $("#delete-modal").modal('hide');

    if (delete_crack_rake_id != "") {
          $.ajax({
          type: "get",
          url: "/delete_crack_rake.js?delete_crack_rake_id=" + delete_crack_rake_id
        });
      }

     $('.other-load-tr:visible').each(function() {
      if($(this).attr("id").split("_")[4] == delete_index){
        $(this).remove('');
      }
    });
  });


 
});


</script>